import sys 
import os
import datetime
import requests

def main():
    cnt=0
    result = getMemberList(cnt)
    
    print(compileList)
    buildId = 'B000' + str(result[0]) 
    response = compileClient(buildId, result[1])
    response= deployClient(buildId)
    print(res)
    
def memberListGenerator(memberList,100):    
    compileList=''
    for member in memberList:
        print(member)
        cnt=cnt+1
        if(compileList==''):
            compileList = member
        else:
            compileList = compileList + ',' + member
        if(cnt==100):
            break
    return cnt, compileList
        
        
def compileClient(buildId, compileList):
    baseURI=r'http://10.200.14.1:29080/bebop-rest/onTheDarkSide/'
    compileParams=r'compile/mainframe-all-apps/uat' + '/' + buildId + '/' + compileList
    request=baseURI + compileParams
    print(request)
    response = requests.get(request)
    return response.text

def getMemberList():
    dirpath = os.getcwd()
    memberListFile = dirpath + "/membersFile.txt"
    print(memberListFile)
    onlFile = open(memberListFile, "r")
    onlMemberList = list(dict.fromkeys(onlFile.read().split('\n')))
    commonMembersDict = dict.fromkeys(onlMemberList)
    memberList = list(commonMembersDict)

def deployClient(buildId):
    baseURI=r'http://10.200.14.1:29080/bebop-rest/onTheDarkSide/'
    deployParams=r'deploy/mainframe-all-apps/uat' + '/' + buildId
    request=baseURI + deployParams
    print(request)
    response = requests.get(request)
    return response.text

if __name__ == '__main__': 
    main()