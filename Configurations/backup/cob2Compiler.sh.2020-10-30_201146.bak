#!/bin/sh
member=$1
base=$2

options="-qLIB,SSR,SIZE(MAX),BUF(32760),XREF(SHORT),NOC(E),NOSEQ,F(W),RENT,TERM,ARITH(EXTEND),OPT(1),SQL,CODEPAGE(1026),ARITH(EXTEND),NOINITCHECK,NONUMCHECK,ARCH(11),DISPSIGN(COMPAT),ZONEDATA(NOPFD),NUMPROC(NOPFD),VLR(STANDARD) -bCALL=NO,LIST=SUMMARY,DYNAM=NO,MSGLEVEL=0"

mbr=${member%.*}

log="$base/log/$mbr""_Compile.log"

cd "$base/source" 1>$log 2>$log

cob2 -v -dbrmlib $options $member -o $mbr 1>$log 2>>$log
cobRC=$?
if test $cobRC -gt 0
then exit $cobRC
else rc=$cobRC
fi

mv "$base/source/$mbr" "$base/mlib/$mbr.mlib" 1>> $log 2>> $log
mvRC=$?
if test $mvRC -gt 0
then exit $mvRC
else rc=$mvRC
fi

FILE="$base/source/$mbr.dbrm"
if [[ -f "$FILE" ]]; then
    mv "$FILE" "$base/dbrm/$mbr.dbrm" 1>> $log 2>> $log
    mvRC=$?
    if test $mvRC -gt 0
    then exit $mvRC
    else rc=$mvRC
    fi	
fi

rm "$base/source/$mbr.lst" 1>> $log 2>> $log
mvRC=$?
if test $mvRC -gt 0
then exit $mvRC
else rc=$mvRC
fi

rm "$base/source/$mbr.o" 1>> $log 2>> $log
mvRC=$?
if test $mvRC -gt 0
then exit $mvRC
else rc=$mvRC
fi

exit rc


# read -p "Press [Enter] key to go on." 
