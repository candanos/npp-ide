#!/bin/sh
member=$1
base=$2
f_sql=$3
mbr=${member%.*}
log="$base"'/log/'"$mbr""_Compile.log"
echo "$member compile script started." >$log

c_options='-qLIB,SSR,SIZE(MAX),BUF(32760),XREF(SHORT),NOC(E),NOSEQ,F(W),RENT,TERM,ARITH(EXTEND),OPT(1),CODEPAGE(1026),ARITH(EXTEND),NOINITCHECK,NONUMCHECK,ARCH(11),DISPSIGN(COMPAT),ZONEDATA(NOPFD),NUMPROC(NOPFD),VLR(STANDARD)' 
b_options='-bCALL=NO,LIST=SUMMARY,DYNAM=NO,MSGLEVEL=0'
sql_options='SQL(HOST(IBMCOB),APOST,APOSTSQL,DEC(31),SQL(DB2),VERSION(AUTO))'

echo '***' >>$log
echo "compiler options are:" >>$log 
echo $c_options >>$log
echo '***' >>$log
echo ' ' >>$log

cd "$base/source" 
echo '***' >>"$log"
echo "current directory is " >>$log
pwd >>$log
echo '***' >>$log
echo ' ' >>$log

echo '***' >>$log
echo "cob2 command output:" >>$log  
if test $f_sql -gt 0
then
cob2 -v -dbrmlib $c_options $b_options $member 1>>$log 2>>$log
cobRC=$?
else
cob2 -v $c_options $b_options $member 1>>$log 2>>$log
cobRC=$?
fi

echo $cobRC >>$log
echo '***' >>$log
echo ' ' >>$log

mv "$base/source/$mbr.o" "$base/mlib/$mbr.mlib" 1>>$log 2>>$log
mv "$base/source/$mbr.dbrm" "$base/dbrm/$mbr.dbrm" 1>>$log 2>>$log
rm "$base/source/$mbr.lst" 1>> $log 2>> $log

exit $cobRC
