import sys 
import os
import datetime
import shutil
import ebcdic
import pathlib

fileName = "YHKEYBUL.cbl"
sourceDir = r'C:/u/ttg/tfsRepos/mainframe-all-apps/COBOL'
targetDir = r'C:/Cloud/github/bebop-rest/target'


def main():    
    convertFileToEbcdic()
    
def convertFileToEbcdic():
    sourceFile = sourceDir + "/" + fileName
    targetFile = targetDir + "/" + fileName
    with open(sourceFile, 'r', encoding='utf-8') as fi: sourceFileinStr = fi.read()

    fileAsStr = ""
    allbytes = bytearray()
    myGen = ispfLineGenerator(sourceFileinStr)
    line = next(myGen)
    while(len(line) == 80):
        newLine = '      ' + str(line[6:72]) + '        '
    # bytearray(b'\xab')
        allbytes.extend(bytes(newLine,'cp1026'))
        allbytes.extend(b'\x0D')
        allbytes.extend(b'\x15')
        line = next(myGen)
        

    with open(targetFile, 'wb') as file: file.write(allbytes)
    
def ispfLineGenerator(string):
    i = 0
    while True:
        yield string[i:i+80]
        i=i+80        


            
    f.close()

if __name__ == '__main__': 
    main()